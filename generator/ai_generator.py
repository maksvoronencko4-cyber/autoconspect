"""
AI –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤ —Å Google Gemini + Wikipedia
"""

import google.generativeai as genai
from datetime import datetime


class AIGenerator:

    def __init__(self, api_key: str = None):
        self.model = None
        self.is_ready = False
        self.model_name = None

        if api_key:
            self._init_model(api_key)

    def _init_model(self, api_key: str):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –∞–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ–º –º–æ–¥–µ–ª–∏"""
        try:
            genai.configure(api_key=api_key)

            models_to_try = [
                'gemini-1.5-flash',
                'gemini-1.5-pro',
                'gemini-pro',
                'gemini-1.0-pro',
                'models/gemini-pro',
                'models/gemini-1.5-flash',
            ]

            for model_name in models_to_try:
                try:
                    model = genai.GenerativeModel(model_name)
                    response = model.generate_content("–ü—Ä–∏–≤–µ—Ç")
                    if response.text:
                        self.model = model
                        self.model_name = model_name
                        self.is_ready = True
                        print(f"‚úÖ –ü–æ–¥–∫–ª—é—á–µ–Ω–∞ –º–æ–¥–µ–ª—å: {model_name}")
                        return
                except Exception as e:
                    print(f"‚ùå –ú–æ–¥–µ–ª—å {model_name}: {e}")
                    continue

            try:
                available_models = genai.list_models()
                for m in available_models:
                    if 'generateContent' in str(m.supported_generation_methods):
                        try:
                            model = genai.GenerativeModel(m.name)
                            response = model.generate_content("–¢–µ—Å—Ç")
                            if response.text:
                                self.model = model
                                self.model_name = m.name
                                self.is_ready = True
                                print(f"‚úÖ –ù–∞–π–¥–µ–Ω–∞ –º–æ–¥–µ–ª—å: {m.name}")
                                return
                        except:
                            continue
            except Exception as e:
                print(f"–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞ –º–æ–¥–µ–ª–µ–π: {e}")

            self.is_ready = False

        except Exception as e:
            print(f"–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ API: {e}")
            self.is_ready = False

    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    #  –ì–õ–ê–í–ù–´–ô –ú–ï–¢–û–î –ì–ï–ù–ï–†–ê–¶–ò–ò
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    def generate(self, mode: str, topic: str, volume: str, style: str,
                 author_info: dict = None, wiki_data: list = None) -> str:

        if not self.is_ready:
            return (f"‚ùå API –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏–ª–∏ –∫–ª—é—á –Ω–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω.\n\n"
                    f"–¢–µ–∫—É—â–∞—è –º–æ–¥–µ–ª—å: {self.model_name or '–Ω–µ –Ω–∞–π–¥–µ–Ω–∞'}")

        prompt = self._build_prompt(mode, topic, volume, style, wiki_data)

        try:
            response = self.model.generate_content(prompt)
            result = response.text

            # –¢–∏—Ç—É–ª—å–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
            if (author_info and author_info.get('include_title')
                    and mode in ['referat', 'doklad', 'essay']):
                title_page = self._generate_title_page(topic, author_info, mode)
                result = title_page + "\n\n" + result

            return result

        except Exception as e:
            error_msg = str(e)
            if "blocked" in error_msg.lower():
                return "‚ùå –ó–∞–ø—Ä–æ—Å –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ç–µ–º—É."
            elif "quota" in error_msg.lower():
                return "‚ùå –ü—Ä–µ–≤—ã—à–µ–Ω –ª–∏–º–∏—Ç –∑–∞–ø—Ä–æ—Å–æ–≤. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ–º–Ω–æ–≥–æ."
            else:
                return f"‚ùå –û—à–∏–±–∫–∞ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏: {error_msg}"

    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    #  –ü–û–°–¢–†–û–ï–ù–ò–ï –ü–†–û–ú–ü–¢–ê
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    def _build_prompt(self, mode, topic, volume, style, wiki_data=None):
        """–°—Ç—Ä–æ–∏—Ç –ø—Ä–æ–º–ø—Ç, –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ wiki_data ‚Äî –¥–æ–±–∞–≤–ª—è–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–∏"""

        base_prompt = self._base_prompt(mode, topic, volume, style)

        if wiki_data:
            wiki_block = self._format_wiki_block(wiki_data)
            return f"{wiki_block}\n\n{base_prompt}"

        return base_prompt

    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    #  –§–û–†–ú–ê–¢–ò–†–û–í–ê–ù–ò–ï –ë–õ–û–ö–ê –í–ò–ö–ò–ü–ï–î–ò–ò
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    def _format_wiki_block(self, wiki_data: list) -> str:
        """–ü—Ä–µ–≤—Ä–∞—â–∞–µ—Ç —Å–ø–∏—Å–æ–∫ —Å—Ç–∞—Ç–µ–π –≤ —Ç–µ–∫—Å—Ç–æ–≤—ã–π –±–ª–æ–∫-–∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è –ø—Ä–æ–º–ø—Ç–∞"""

        lines = []
        lines.append("üìö –ú–ê–¢–ï–†–ò–ê–õ–´ –ò–ó –í–ò–ö–ò–ü–ï–î–ò–ò ‚Äî –ò–°–ü–û–õ–¨–ó–£–ô –ö–ê–ö –û–°–ù–û–í–ù–û–ô –ò–°–¢–û–ß–ù–ò–ö")
        lines.append("=" * 60)

        wiki_refs = []

        for i, article in enumerate(wiki_data, 1):
            lines.append(f"\nüìÑ –ò—Å—Ç–æ—á–Ω–∏–∫ {i}: {article['title']}")
            lines.append(f"   URL: {article['url']}")
            lines.append("-" * 50)
            lines.append(article['content'])
            lines.append("=" * 60)

            wiki_refs.append(
                f"{article['title']} // –í–∏–∫–∏–ø–µ–¥–∏—è ‚Äî —Å–≤–æ–±–æ–¥–Ω–∞—è —ç–Ω—Ü–∏–∫–ª–æ–ø–µ–¥–∏—è. "
                f"URL: {article['url']}"
            )

        lines.append("\n‚ö†Ô∏è –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï –ü–†–ê–í–ò–õ–ê:")
        lines.append("1. –û—Å–Ω–æ–≤—ã–≤–∞–π—Å—è –¢–û–õ–¨–ö–û –Ω–∞ —Ñ–∞–∫—Ç–∞—Ö –∏–∑ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –≤—ã—à–µ.")
        lines.append("2. –ù–ï –ø—Ä–∏–¥—É–º—ã–≤–∞–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –∫–æ—Ç–æ—Ä–æ–π –Ω–µ—Ç –≤ –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö.")
        lines.append("3. –°—Å—ã–ª–∞–π—Å—è –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∏–∑ –í–∏–∫–∏–ø–µ–¥–∏–∏ –≤ —Ç–µ–∫—Å—Ç–µ.")
        lines.append("4. –í –°–ü–ò–°–û–ö –õ–ò–¢–ï–†–ê–¢–£–†–´ –≤–∫–ª—é—á–∏:")
        for ref in wiki_refs:
            lines.append(f"   ‚Ä¢ {ref}")
        lines.append("")

        return "\n".join(lines)

    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    #  –ë–ê–ó–û–í–´–ï –ü–†–û–ú–ü–¢–´ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –ø–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ)
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    def _base_prompt(self, mode, topic, volume, style):

        volume_text = {
            "short": "–ù–∞–ø–∏—à–∏ –∫—Ä–∞—Ç–∫–æ, 1-2 —Å—Ç—Ä–∞–Ω–∏—Ü—ã.",
            "medium": "–ù–∞–ø–∏—à–∏ —Å—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º, 3-5 —Å—Ç—Ä–∞–Ω–∏—Ü.",
            "long": "–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω–æ, 6-10 —Å—Ç—Ä–∞–Ω–∏—Ü.",
            "very_long": "–ù–∞–ø–∏—à–∏ –æ—á–µ–Ω—å –ø–æ–¥—Ä–æ–±–Ω–æ, 10-15 —Å—Ç—Ä–∞–Ω–∏—Ü."
        }.get(volume, "–°—Ä–µ–¥–Ω–∏–π –æ–±—ä—ë–º.")

        style_text = {
            "scientific": "–ù–∞—É—á–Ω—ã–π –∞–∫–∞–¥–µ–º–∏—á–µ—Å–∫–∏–π —Å—Ç–∏–ª—å.",
            "simple": "–ü—Ä–æ—Å—Ç–æ–π –ø–æ–Ω—è—Ç–Ω—ã–π —è–∑—ã–∫.",
            "school": "–Ø–∑—ã–∫ –¥–ª—è —à–∫–æ–ª—å–Ω–∏–∫–∞.",
            "university": "–Ø–∑—ã–∫ –¥–ª—è —Å—Ç—É–¥–µ–Ω—Ç–∞."
        }.get(style, "–ù–∞—É—á–Ω—ã–π —Å—Ç–∏–ª—å.")

        prompts = {
            "referat": f"""–ù–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π —Ä–µ—Ñ–µ—Ä–∞—Ç –Ω–∞ —Ç–µ–º—É: "{topic}"

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- {volume_text}
- {style_text}
- –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã, –¥–∞—Ç—ã, –∏–º–µ–Ω–∞

–û–±—è–∑–∞—Ç–µ–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞:

# –†–ï–§–ï–†–ê–¢
## –¢–µ–º–∞: {topic}

## –í–í–ï–î–ï–ù–ò–ï
- –ê–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ–º—ã (–ø–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ)
- –¶–µ–ª—å —Ä–∞–±–æ—Ç—ã
- –ó–∞–¥–∞—á–∏ —Ä–∞–±–æ—Ç—ã

## –ì–õ–ê–í–ê 1. [–ü—Ä–∏–¥—É–º–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ]
### 1.1 [–ü–æ–¥—Ä–∞–∑–¥–µ–ª]
[–ù–∞–ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ñ–∞–∫—Ç–∞–º–∏, –º–∏–Ω–∏–º—É–º 2-3 –∞–±–∑–∞—Ü–∞]

### 1.2 [–ü–æ–¥—Ä–∞–∑–¥–µ–ª]
[–ù–∞–ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç]

## –ì–õ–ê–í–ê 2. [–ü—Ä–∏–¥—É–º–∞–π –Ω–∞–∑–≤–∞–Ω–∏–µ]
### 2.1 [–ü–æ–¥—Ä–∞–∑–¥–µ–ª]
[–ù–∞–ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç —Å —Ñ–∞–∫—Ç–∞–º–∏]

### 2.2 [–ü–æ–¥—Ä–∞–∑–¥–µ–ª]
[–ù–∞–ø–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç]

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï
- –û—Å–Ω–æ–≤–Ω—ã–µ –≤—ã–≤–æ–¥—ã –ø–æ —Ä–∞–±–æ—Ç–µ
- –ß—Ç–æ —É–¥–∞–ª–æ—Å—å –≤—ã—è—Å–Ω–∏—Ç—å

## –°–ü–ò–°–û–ö –õ–ò–¢–ï–†–ê–¢–£–†–´
1. [–ê–≤—Ç–æ—Ä –ò.–ò. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏. ‚Äî –ú.: –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –ì–æ–¥.]
2. [–ê–≤—Ç–æ—Ä –ò.–ò. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏. ‚Äî –ú.: –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –ì–æ–¥.]
3. [–ê–≤—Ç–æ—Ä –ò.–ò. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏. ‚Äî –ú.: –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –ì–æ–¥.]
4. [–ê–≤—Ç–æ—Ä –ò.–ò. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏. ‚Äî –ú.: –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –ì–æ–¥.]
5. [–ê–≤—Ç–æ—Ä –ò.–ò. –ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏. ‚Äî –ú.: –ò–∑–¥–∞—Ç–µ–ª—å—Å—Ç–≤–æ, –ì–æ–¥.]

–í–ê–ñ–ù–û: –ü–∏—à–∏ —Ä–µ–∞–ª—å–Ω—ã–π —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω—ã–π —Ç–µ–∫—Å—Ç, –Ω–µ —à–∞–±–ª–æ–Ω—ã!""",

            "conspect": f"""–ù–∞–ø–∏—à–∏ –ø–æ–¥—Ä–æ–±–Ω—ã–π –∫–æ–Ω—Å–ø–µ–∫—Ç –Ω–∞ —Ç–µ–º—É: "{topic}"

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- {volume_text}
- {style_text}
- –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–∞–ª—å–Ω—ã–µ —Ñ–∞–∫—Ç—ã

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

# üìù –ö–û–ù–°–ü–ï–ö–¢: {topic}

## üîë –û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ–Ω—è—Ç–∏—è –∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
**[–¢–µ—Ä–º–∏–Ω 1]** ‚Äî [—Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ]
**[–¢–µ—Ä–º–∏–Ω 2]** ‚Äî [—Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ]
**[–¢–µ—Ä–º–∏–Ω 3]** ‚Äî [—Ç–æ—á–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ]

## üìö –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

### 1. [–ü–µ—Ä–≤—ã–π —Ä–∞–∑–¥–µ–ª]
‚Ä¢ [–í–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç –∏–ª–∏ —Ç–µ–∑–∏—Å]
‚Ä¢ [–í–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç –∏–ª–∏ —Ç–µ–∑–∏—Å]
‚Ä¢ [–í–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç –∏–ª–∏ —Ç–µ–∑–∏—Å]

**–ó–∞–ø–æ–º–Ω–∏:** [–∫–ª—é—á–µ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è]

### 2. [–í—Ç–æ—Ä–æ–π —Ä–∞–∑–¥–µ–ª]
‚Ä¢ [–í–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç]
‚Ä¢ [–í–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç]

### 3. [–¢—Ä–µ—Ç–∏–π —Ä–∞–∑–¥–µ–ª]
‚Ä¢ [–í–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç]
‚Ä¢ [–í–∞–∂–Ω—ã–π —Ñ–∞–∫—Ç]

## ‚úÖ –í—ã–≤–æ–¥—ã
1. [–ì–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥]
2. [–í—Ç–æ—Ä–æ–π –≤—ã–≤–æ–¥]
3. [–¢—Ä–µ—Ç–∏–π –≤—ã–≤–æ–¥]

## üí° –ß—Ç–æ –Ω—É–∂–Ω–æ –∑–∞–ø–æ–º–Ω–∏—Ç—å
‚Ä¢ [–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ 1]
‚Ä¢ [–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ 2]
‚Ä¢ [–°–∞–º–æ–µ –≤–∞–∂–Ω–æ–µ 3]

–ü–∏—à–∏ —Ä–µ–∞–ª—å–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –ø–æ —Ç–µ–º–µ!""",

            "doklad": f"""–ù–∞–ø–∏—à–∏ –ø–æ–ª–Ω—ã–π —Ç–µ–∫—Å—Ç –¥–æ–∫–ª–∞–¥–∞ –Ω–∞ —Ç–µ–º—É: "{topic}"

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- {volume_text}
- {style_text}
- –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –¢–µ–∫—Å—Ç –¥–ª—è —É—Å—Ç–Ω–æ–≥–æ –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –∫–ª–∞—Å—Å–æ–º

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

# üìä –î–û–ö–õ–ê–î
## –¢–µ–º–∞: {topic}

## –í–°–¢–£–ü–õ–ï–ù–ò–ï

–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –°–µ–≥–æ–¥–Ω—è —è —Ä–∞—Å—Å–∫–∞–∂—É –≤–∞–º –æ —Ç–µ–º–µ "{topic}".

[–ü–æ—á–µ–º—É —ç—Ç–∞ —Ç–µ–º–∞ –≤–∞–∂–Ω–∞ ‚Äî 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]

[–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è]

## –û–°–ù–û–í–ù–ê–Ø –ß–ê–°–¢–¨

### [–ü–µ—Ä–≤—ã–π –ø—É–Ω–∫—Ç]
[–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑ —Å —Ñ–∞–∫—Ç–∞–º–∏, –¥–∞—Ç–∞–º–∏, –∏–º–µ–Ω–∞–º–∏ ‚Äî –º–∏–Ω–∏–º—É–º 2 –∞–±–∑–∞—Ü–∞]

### [–í—Ç–æ—Ä–æ–π –ø—É–Ω–∫—Ç]
[–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑ ‚Äî –º–∏–Ω–∏–º—É–º 2 –∞–±–∑–∞—Ü–∞]

### [–¢—Ä–µ—Ç–∏–π –ø—É–Ω–∫—Ç]
[–ü–æ–¥—Ä–æ–±–Ω—ã–π —Ä–∞—Å—Å–∫–∞–∑]

### –ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ–∞–∫—Ç—ã
‚Ä¢ [–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç 1]
‚Ä¢ [–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç 2]
‚Ä¢ [–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç 3]

## –ó–ê–ö–õ–Æ–ß–ï–ù–ò–ï

–í –∑–∞–∫–ª—é—á–µ–Ω–∏–µ —Ö–æ—á—É —Å–∫–∞–∑–∞—Ç—å, —á—Ç–æ [–≥–ª–∞–≤–Ω—ã–π –≤—ã–≤–æ–¥].

[–ü–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤ ‚Äî 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]

–°–ø–∞—Å–∏–±–æ –∑–∞ –≤–Ω–∏–º–∞–Ω–∏–µ! –ì–æ—Ç–æ–≤ –æ—Ç–≤–µ—Ç–∏—Ç—å –Ω–∞ –≤–∞—à–∏ –≤–æ–ø—Ä–æ—Å—ã.

–ü–∏—à–∏ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ –∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ!""",

            "question": f"""–î–∞–π –ø–æ–ª–Ω—ã–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å: "{topic}"

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- {volume_text}
- {style_text}
- –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

# ‚ùì –í–æ–ø—Ä–æ—Å:
{topic}

## ‚úÖ –ö—Ä–∞—Ç–∫–∏–π –æ—Ç–≤–µ—Ç
[–ü—Ä—è–º–æ–π –æ—Ç–≤–µ—Ç –Ω–∞ –≤–æ–ø—Ä–æ—Å ‚Äî 2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è]

## üìñ –†–∞–∑–≤—ë—Ä–Ω—É—Ç—ã–π –æ—Ç–≤–µ—Ç
[–ü–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ –∞–±–∑–∞—Ü–µ–≤]
[–§–∞–∫—Ç—ã –∏ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞]
[–†–∞–∑–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã –≤–æ–ø—Ä–æ—Å–∞]

## üìù –ü—Ä–∏–º–µ—Ä—ã
1. [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä]
2. [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä]
3. [–ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –ø—Ä–∏–º–µ—Ä]

## üéØ –í—ã–≤–æ–¥
[–ò—Ç–æ–≥–æ–≤–æ–µ –∑–∞–∫–ª—é—á–µ–Ω–∏–µ]

–ü–∏—à–∏ —Å–æ–¥–µ—Ä–∂–∞—Ç–µ–ª—å–Ω–æ!""",

            "retell": f"""–°–¥–µ–ª–∞–π –ø–µ—Ä–µ—Å–∫–∞–∑ —Ç–µ–∫—Å—Ç–∞: "{topic}"

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- {volume_text}
- {style_text}
- –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

# üìñ –ü–ï–†–ï–°–ö–ê–ó

## –û —á—ë–º —Ç–µ–∫—Å—Ç (–∫—Ä–∞—Ç–∫–æ)
[2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –æ –≥–ª–∞–≤–Ω–æ–º]

## –ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–µ—Ä–µ—Å–∫–∞–∑
[–ò–∑–ª–æ–∂–∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–≤–æ–∏–º–∏ —Å–ª–æ–≤–∞–º–∏]
[–°–æ—Ö—Ä–∞–Ω–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å]
[–£–ø–æ–º—è–Ω–∏ –∫–ª—é—á–µ–≤—ã–µ –¥–µ—Ç–∞–ª–∏]

## –ì–ª–∞–≤–Ω–∞—è –º—ã—Å–ª—å
[–ß—Ç–æ —Ö–æ—Ç–µ–ª —Å–∫–∞–∑–∞—Ç—å –∞–≤—Ç–æ—Ä]

## –ö–ª—é—á–µ–≤—ã–µ –º–æ–º–µ–Ω—Ç—ã
‚Ä¢ [–ú–æ–º–µ–Ω—Ç 1]
‚Ä¢ [–ú–æ–º–µ–Ω—Ç 2]
‚Ä¢ [–ú–æ–º–µ–Ω—Ç 3]""",

            "essay": f"""–ù–∞–ø–∏—à–∏ —ç—Å—Å–µ –Ω–∞ —Ç–µ–º—É: "{topic}"

–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- {volume_text}
- {style_text}
- –ü–∏—à–∏ –Ω–∞ —Ä—É—Å—Å–∫–æ–º —è–∑—ã–∫–µ
- –≠—Å—Å–µ –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –ª–∏—á–Ω—ã–µ —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏—è

–°—Ç—Ä—É–∫—Ç—É—Ä–∞:

# ‚úçÔ∏è –≠–°–°–ï
## {topic}

*"[–ü–æ–¥–±–µ—Ä–∏ –ø–æ–¥—Ö–æ–¥—è—â–∏–π —ç–ø–∏–≥—Ä–∞—Ñ ‚Äî —Ü–∏—Ç–∞—Ç—É –∏–∑–≤–µ—Å—Ç–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞]"*

## –í—Å—Ç—É–ø–ª–µ–Ω–∏–µ
[–í–≤–µ–¥–µ–Ω–∏–µ –≤ —Ç–µ–º—É ‚Äî –ø–æ—á–µ–º—É –æ–Ω–∞ –≤–∞–∂–Ω–∞]
[–õ–∏—á–Ω–æ–µ –æ—Ç–Ω–æ—à–µ–Ω–∏–µ –∫ —Ç–µ–º–µ]

## –†–∞–∑–º—ã—à–ª–µ–Ω–∏—è

### –ü–µ—Ä–≤–∞—è –º—ã—Å–ª—å
[–†–∞—Å—Å—É–∂–¥–µ–Ω–∏–µ —Å –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏]
[–ü—Ä–∏–º–µ—Ä—ã –∏–∑ –∂–∏–∑–Ω–∏, –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä—ã, –∏—Å—Ç–æ—Ä–∏–∏]

### –í—Ç–æ—Ä–∞—è –º—ã—Å–ª—å
[–î—Ä—É–≥–æ–π –∞—Å–ø–µ–∫—Ç —Ç–µ–º—ã]
[–ê—Ä–≥—É–º–µ–Ω—Ç—ã –∏ –ø—Ä–∏–º–µ—Ä—ã]

### –¢—Ä–µ—Ç—å—è –º—ã—Å–ª—å
[–í–æ–∑–º–æ–∂–Ω–æ, –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω–∞—è —Ç–æ—á–∫–∞ –∑—Ä–µ–Ω–∏—è]

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ
[–õ–∏—á–Ω—ã–µ –≤—ã–≤–æ–¥—ã]
[–§–∏–Ω–∞–ª—å–Ω–∞—è –º—ã—Å–ª—å]

–ü–∏—à–∏ —Å –¥—É—à–æ–π –∏ –ª–∏—á–Ω–æ–π –ø–æ–∑–∏—Ü–∏–µ–π!"""
        }

        return prompts.get(mode, prompts["referat"])

    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    #  –¢–ò–¢–£–õ–¨–ù–ê–Ø –°–¢–†–ê–ù–ò–¶–ê
    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
    def _generate_title_page(self, topic, author_info, mode):

        work_type = {
            "referat": "–†–ï–§–ï–†–ê–¢",
            "doklad": "–î–û–ö–õ–ê–î",
            "essay": "–≠–°–°–ï"
        }.get(mode, "–†–ï–§–ï–†–ê–¢")

        edu_type = author_info.get('edu_type', '–°—Ç—É–¥–µ–Ω—Ç')
        grade = author_info.get('grade', '1')
        name = author_info.get('name', '')
        institution = author_info.get('institution', '')
        group = author_info.get('group', '')
        teacher = author_info.get('teacher', '')

        grade_text = (f"{grade} –∫–ª–∞—Å—Å–∞" if edu_type == "–£—á–µ–Ω–∏–∫"
                      else f"{grade} –∫—É—Ä—Å–∞")
        year = datetime.now().year

        lines = [
            "=" * 60, "",
            institution.upper() if institution else "[–£–ß–ï–ë–ù–û–ï –ó–ê–í–ï–î–ï–ù–ò–ï]",
            "", "-" * 60, "",
            work_type, "",
            "–Ω–∞ —Ç–µ–º—É:",
            f'¬´{topic}¬ª',
            "", "-" * 60, "",
            "–í—ã–ø–æ–ª–Ω–∏–ª(–∞):",
            f"{edu_type} {grade_text}",
        ]

        if name:
            lines.append(name)
        if group:
            lines.append(f"–ì—Ä—É–ø–ø–∞: {group}")
        if teacher:
            lines.extend(["", f"–ü—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å: {teacher}"])

        lines.extend(["", "-" * 60, "", f"{year} –≥–æ–¥", "", "=" * 60])

        return "\n".join(lines)
